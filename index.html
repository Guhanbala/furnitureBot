<!DOCTYPE html>
<html>
<head>
  <title>V Furnish Voice Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 50px;
      background: #fff8e7;
    }
    button {
      padding: 20px 40px;
      font-size: 22px;
      background: #ff4500;
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
    }
    #text {
      margin-top: 30px;
      font-size: 24px;
      color: #d4380d;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>V Furnish Voice Assistant</h1>
  <button id="rec">üé§ SPEAK NOW</button>
  <div id="text">Press the button and speak for 4 seconds...</div>

  <script type="module">
    const HF_TOKEN = "hf_moBpyzfWppUGwsqWXBrvfjkrovJuDGVdBLE";
    const HF_MODEL_URL = "https://api-inference.huggingface.co/models/guillaumekln/faster-whisper-tiny";

    const button = document.getElementById('rec');
    const output = document.getElementById('text');
    let rec, chunks = [];

    button.onclick = async () => {
      try {
        output.textContent = "üéôÔ∏è Recording for 4 seconds...";
        chunks = [];
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        rec = new MediaRecorder(stream, { mimeType: 'audio/webm;codecs=opus' });

        rec.ondataavailable = e => chunks.push(e.data);
        rec.onstop = () => {
          console.log("Recording stopped, chunks:", chunks.length);
          sendToHF();
        };

        rec.start();
        setTimeout(() => rec.stop(), 4000);
      } catch (err) {
        console.error("Microphone access error:", err);
        output.textContent = "‚ö†Ô∏è Microphone not accessible!";
      }
    };

    async function sendToHF() {
      try {
        output.textContent = "‚è≥ Processing...";
        const blob = new Blob(chunks, { type: 'audio/webm' });

        const res = await fetch(HF_MODEL_URL, {
          method: "POST",
          headers: { "Authorization": "Bearer " + HF_TOKEN },
          body: blob
        });

        const data = await res.json();
        console.log("API Response:", data);

        if (data.text) {
          output.textContent = "üó£Ô∏è You said: " + data.text.trim();
        } else if (data.error) {
          output.textContent = "‚ö†Ô∏è Error: " + data.error;
        } else {
          output.textContent = "ü§î Couldn't understand ‚Äî try again!";
        }

      } catch (err) {
        console.error("Error sending to HF:", err);
        output.textContent = "‚ö†Ô∏è Network or API error!";
      }
    }
  </script>
</body>
</html>
